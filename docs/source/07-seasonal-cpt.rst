CPT
===

The Climate Predictability Tool (CPT) allows you to build a seasonal climate forecast model, perform model validation, and produce forecasts with up-to-date data. The climatic prediction that is made is of a diagnostic type; that is, it is assumed that the relationship between the predictor and the predictand is immediate.

In this case, CPT has as inputs the sea surface temperature (SST) data (predictor) and the historical precipitation data of the different departments/states (predictor). These last data are imported; explained in :ref:`Importing data`. These data will be used to train the model to be able to predict precipitation for six months.

It is important to clarify that since the type of prediction that is made is diagnostic, there are no SST data for future periods. That is, if you wanted to predict precipitation for year m+1, where m is the current year, you would need SST data for year m+1. Therefore, the predictor used in the model to obtain the predictand comes from global circulation models (GCM). When using the outputs of GCM models as predictors, the error that those models may have had is assumed. Adding in turn, the error that our model may have.

The process begins by downloading SST data from IRIDL and preparing the precipitation data for each location. These precipitation data by department are taken from the database that is configured through the Aclimate webadmin. The SST data is organized in raster format and is used to define the predictor area. This area is defined with the configuration files that each state/locality has and ten runs are made to optimize the area.

Once the SST data is organized in raster format and the historical precipitation data of the states are prepared, pre-filtering with a principal component analysis (PCA) is performed on the predictor (SST) and the predictand (precipitation). This PCA reduces the number of variables that are potentially related; To do this, define how many components for X (SST) and for Y (precipitation) are desired. In this case ten are used in both.

Once the PCA is performed, a canonical correlation analysis (CCA) is performed. This CCA allows maximizing the relationship between the predictor and predictand components. Finding in this way the best relationships in both. Once this point is reached, the model is ready to make the precipitation forecast and a probabilistic prediction is made. That is, the probability that the precipitation in the next quarters is above, below or normal.

All this process is done quarterly. Therefore, since you want to know the precipitation for six months, this process is done twice. In addition to these two runs per quarter, there is also one run for each department/state. The probabilistic data generated by this forecast process have for each department and quarter their probabilities of precipitation below, within normal and above normal.

Finally, a gamma transformation is done. This process is optional in CPT. It is carried out at the request of some experts and deals with a fit of the data in a gamma distribution.

The final output of this process is a file called probabilities.csv. This file has six columns: year, id of the stations/locations, central month of the quarter, and the remaining three are the percentage values of precipitation below normal, within normal, and above normal.
In addition, there is also the metrics.csv file with seven (nine for Ethiopia) columns: year, id of the stations/locations, central month of the quarter and the metrics (pearson, kendall, goodness, canonica). For Ethiopia the metrics are: afc2, groc, ignorance, pearson, rpss, spearman.

The following diagram describes the process mentioned above:

.. image:: /_static/img/07-forecast/07_CPT.*
  :alt: CPT process activity diagram
  :class: device-screen-vertical side-by-side