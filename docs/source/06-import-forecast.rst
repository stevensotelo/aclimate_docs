.. _Forecast:

Forecast
########

Forecast app allows you to import a new forecast or import information to a previously created forecast, this allows you to store the information of probabilities, metrics, crop data, the 100 forecast scenarios for each weather station, rasters and other data included in the forecast. 



#. To start importing, the folders obtained from the forecasting process must be prepared. The folders must have the following format.

        .. image:: /_static/img/06-import-forecast/import_forecast_1.*
            :alt: Guide how to import forecast 1
            :class: device-screen-vertical side-by-side

    - **cultivos**: Contains the folders of each crop of the system with their respective data obtained from the crop models of the forecast.
    - **prediccionClimatica**: Contains the folders with the data of the probabilities generated by the forecast as well as the forecast metrics.

        It also contains the resampling with the 100 scenarios for each weather station and the observed data generated to complete the scenarios in the countries where planting window is being used. 

        Finally it also contains the rasters that will be copied and stored.



#. To import forecast data you must access the path where ForecastApp is located through the console, either Linux or Windows.

        .. image:: /_static/img/06-import-forecast/import_2.*
            :alt: Guide how to import forecast 2
            :class: device-screen-vertical side-by-side

    .. note::

        If you are using Windows it is recommended to use CMD.

#. To execute any ForecastApp command you must use the following line of code **dotnet CIAT.DAPA.USAID.Forecast.ForecastApp.dll** this will execute the file that will start the ForecastApp process, this command must be followed by the action you want to do.

#. To execute the import of the forecast data you must use the following command **dotnet CIAT.DAPA.USAID.Forecast.ForecastApp.dll -in -fs -p "forecast ouput folder path" -cf value -frid value**.

        .. image:: /_static/img/06-import-forecast/import_forecast_3.*
            :alt: Guide how to import forecast 3
            :class: device-screen-vertical side-by-side

    .. note::

        The command consists of the following parts:

            * **dotnet CIAT.DAPA.USAID.Forecast.ForecastApp.dll** = This is the first mandatory part for all ForecastApp commands, it must be complemented with the command you want to perform.
            * **-in** = As this is an import process, the -in parameter must be used to indicate that a data import will be performed.
            * **-fs** = This parameter indicates that an import process of forecast will be performed, it is mandatory if you want to perform this process.
            * **-p "ranges configuration file path"** = The -p parameter indicates the path where the file to be imported are located, this parameter is followed by the path where this file is located, example: **-p "C:\\unified_outputs\\outputs\\"**
                
                - In case you use a Linux operating system the path must be separated by **/** and in Windows you must use **\\**.
                - Linux example: **-p "/Daily-20221214T155614Z-001/Daily/Csv/Import/"**
                - Windows example: **-p "C:\\Daily-20221214T155614Z-001\\Daily\\Csv\\Import\\"**

            * **-cf** = This parameter indicates the confidence value for the intervals confidence. It is a float value. Example **-cf 0.5**
            * **-frid** = This parameter indicates the Id of a previously imported forecast, adding this parameter in the command will perform the import of the data on the supplied forecast. This parameter is optional. Example **-frid "63b9c071368fee5585f307ed"**

#. Once the command is prepared with all the parameters, copy the command in the console and press Enter, the process will perform the import of all data and once finished it will display the message **Forecast imported**.



Content of prediccionClimatica
==============================


**Probabilities**


.. list-table:: CSV columns
  :widths: 25 25
  :header-rows: 1

  * - Column
    - Meaning
  
  * - **year**
    - It is the year of the forecast.
  * - **month**
    - It is the month of the forecast.
  * - **id**
    - It is the id of the weather station to which the forecast data belongs.
  * - **below**
    - It is the probability generated by the forecast which indicates that the values may be below normal having the indicated percentage. The value is a double between 1 and 0.
  * - **normal**
    - It is the probability generated by the forecast which indicates that the values may be in the normal range. The value is a double between 1 and 0.
  * - **above**
    - It is the probability generated by the forecast which indicates that the values may be above normal having the indicated percentage. The value is a double between 1 and 0.


The probabilities file is one of the data imported from the forecast, it is located inside the **probForecast** folder. This file must have the following structure:

  * It must be a plain text file separated by **","** csv.

  * In values of type double, the **"."** must be used as a decimal point.

  * The first row of the file is the header and should be in the following format:

    **year,month,id,below,normal,above**

  * The following lines should contains the information to perform the importing of the soil data. Example:

    **2023,2,5e91e1c214daf81260ebba59,0.157616196,0.342055206,0.500328598**


The following is an example of what the file would look like in the excel viewer

  .. image:: /_static/img/06-import-forecast/import_probabilities_example_1.*
    :alt: How looks the import csv file 1
    :class: device-screen-vertical side-by-side


The following is an example of what the file would look like in text viewer

  .. image:: /_static/img/06-import-forecast/import_probabilities_example_2.*
    :alt: How looks the import csv file 2
    :class: device-screen-vertical side-by-side


**Metrics**


.. list-table:: CSV columns
  :widths: 25 25
  :header-rows: 1

  * - Column
    - Meaning
  
  * - **year**
    - It is the year of the forecast.
  * - **month**
    - It is the month of the forecast.
  * - **id**
    - It is the id of the weather station to which the forecast data belongs.
  * - **below**
    - It is the probability generated by the forecast which indicates that the values may be below normal having the indicated percentage. The value is a double between 1 and 0.
  * - **normal**
    - It is the probability generated by the forecast which indicates that the values may be in the normal range. The value is a double between 1 and 0.
  * - **above**
    - It is the probability generated by the forecast which indicates that the values may be above normal having the indicated percentage. The value is a double between 1 and 0.


The metrics file is one of the data imported from the forecast, it is located inside the **probForecast** folder. This file must have the following structure:

    * It must be a plain text file separated by **","** csv.

    * In values of type double, the **"."** must be used as a decimal point.

    * The first row of the file is the header and should be in the following format:

      **year,month,id,below,normal,above**

    * The following lines should contains the information to perform the importing of the soil data. Example:

      **2023,2,5e91e1c214daf81260ebba59,0.157616196,0.342055206,0.500328598**


The following is an example of what the file would look like in the excel viewer

    .. image:: /_static/img/06-import-forecast/import_probabilities_example_1.*
      :alt: How looks the import csv file 1
      :class: device-screen-vertical side-by-side


The following is an example of what the file would look like in text viewer

    .. image:: /_static/img/06-import-forecast/import_probabilities_example_2.*
      :alt: How looks the import csv file 2
      :class: device-screen-vertical side-by-side